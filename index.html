<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Industry Trends: Presenter Mode</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Inter', sans-serif; }
        
        /* --- HUD (HEADS UP DISPLAY) --- */
        /* Panel Superior: Contexto General */
        #top-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 40px 60px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
            z-index: 10;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }
        
        h1 {
            color: white; margin: 0; font-weight: 800; font-size: 2rem;
            letter-spacing: -1px; text-transform: uppercase;
        }
        .subtitle { color: #888; font-size: 0.9rem; font-weight: 300; margin-top: 5px; }

        /* Indicador de Estado (Invisible salvo interacción) */
        #gesture-feedback {
            color: rgba(255,255,255,0.5);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        /* Panel Inferior: Detalles (Solo aparece al "Entrar") */
        #detail-panel {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            padding: 60px;
            box-sizing: border-box;
            background: linear-gradient(to top, rgba(0,0,0,1) 20%, transparent);
            color: white;
            transform: translateY(100%); /* Oculto por defecto */
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        #detail-panel.active { transform: translateY(0); }

        .big-year {
            font-size: 8rem; font-weight: 800; line-height: 0.8;
            background: -webkit-linear-gradient(#fff, #666);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
        }

        .stats-grid {
            display: flex; gap: 40px; margin-bottom: 15px;
        }
        
        .stat-item { display: flex; flex-direction: column; }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; color: #666; font-family: 'JetBrains Mono'; margin-bottom: 5px; }
        .stat-val { font-size: 2.5rem; font-weight: 600; }
        
        .c-aaa { color: #ff3333; }
        .c-aa { color: #ffcc00; }
        .c-indie { color: #00ffff; }

        .event-box {
            max-width: 500px;
            border-left: 4px solid #fff;
            padding-left: 20px;
        }
        .event-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 10px; color: #fff; }
        .event-desc { font-size: 1rem; color: #aaa; line-height: 1.5; }

        /* Loader */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white; font-family: 'JetBrains Mono';
        }
    </style>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.154.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.154.0/examples/jsm/" } }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>

    <div id="loader">
        <p>INICIALIZANDO SISTEMA DE PRESENTACIÓN...</p>
        <p style="font-size:0.8rem; color:#666">Por favor, permite el acceso a la cámara (Invisible)</p>
    </div>

    <div id="top-bar">
        <div>
            <h1>The Shift</h1>
            <div class="subtitle">ANÁLISIS DE MERCADO 2000-2025</div>
        </div>
        <div id="gesture-feedback">ESPERANDO GESTO...</div>
    </div>

    <div id="detail-panel">
        <div>
            <div class="big-year" id="ui-year">2000</div>
            <div class="event-box">
                <div class="event-title" id="ui-event-title"></div>
                <div class="event-desc" id="ui-event-desc"></div>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">AAA Power</span>
                <span class="stat-val c-aaa" id="ui-aaa">88</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">AA Power</span>
                <span class="stat-val c-aa" id="ui-aa">35</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Indie Power</span>
                <span class="stat-val c-indie" id="ui-indie">15</span>
            </div>
        </div>
    </div>

    <video id="input-video" style="display:none"></video>
    <div id="canvas-container"></div>

    <script type="module">
        import * as THREE from 'three';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';

        // --- DATOS ---
        const data = [
            { year: 2000, aaa: 88, aa: 35, indie: 15, title: "La Era Dorada Retail", desc: "Dominio absoluto del formato físico y grandes editoras." },
            { year: 2001, aaa: 87, aa: 36, indie: 18, title: "", desc: "" },
            { year: 2002, aaa: 86, aa: 38, indie: 21, title: "", desc: "" },
            { year: 2003, aaa: 85, aa: 39, indie: 24, title: "El Nacimiento de Steam", desc: "Valve inicia la transición digital, aunque resistida inicialmente." },
            { year: 2004, aaa: 84, aa: 41, indie: 27, title: "", desc: "" },
            { year: 2005, aaa: 83, aa: 42, indie: 30, title: "", desc: "" },
            { year: 2006, aaa: 82, aa: 44, indie: 33, title: "", desc: "" },
            { year: 2007, aaa: 82, aa: 45, indie: 36, title: "Narrativa Emergente", desc: "BioShock y Portal demuestran que el guion importa más que los gráficos." },
            { year: 2008, aaa: 81, aa: 47, indie: 39, title: "CRISIS & EL BOOM INDIE", desc: "Braid demuestra que un equipo pequeño puede vender millones." },
            { year: 2009, aaa: 80, aa: 48, indie: 42, title: "El Fenómeno Minecraft", desc: "Notch lanza la Alpha que cambiaría la industria para siempre." },
            { year: 2010, aaa: 79, aa: 50, indie: 45, title: "", desc: "" },
            { year: 2011, aaa: 78, aa: 52, indie: 48, title: "El Culto Dark Souls", desc: "FromSoftware redefine el AA: nicho pero de altísima fidelidad." },
            { year: 2012, aaa: 77, aa: 54, indie: 51, title: "", desc: "" },
            { year: 2013, aaa: 76, aa: 56, indie: 54, title: "", desc: "" },
            { year: 2014, aaa: 75, aa: 58, indie: 57, title: "", desc: "" },
            { year: 2015, aaa: 74, aa: 60, indie: 60, title: "Saturación del Mercado", desc: "Steam Direct abre las compuertas. El descubrimiento se vuelve vital." },
            { year: 2016, aaa: 73, aa: 62, indie: 63, title: "", desc: "" },
            { year: 2017, aaa: 72, aa: 64, indie: 66, title: "Indies Masivos", desc: "Hollow Knight ofrece 50 horas de contenido por 15$. El valor percibido cambia." },
            { year: 2018, aaa: 71, aa: 76, indie: 69, title: "El Sorpasso de Calidad", desc: "La media crítica de los mejores AA supera a los AAA genéricos." },
            { year: 2019, aaa: 71, aa: 75, indie: 72, title: "", desc: "" },
            { year: 2020, aaa: 70, aa: 74, indie: 75, title: "EL GRAN PUNTO DE INFLEXIÓN", desc: "Hades gana el GOTY. Los indies ya no son 'juegos pequeños'." },
            { year: 2021, aaa: 69, aa: 73, indie: 78, title: "", desc: "" },
            { year: 2022, aaa: 68, aa: 72, indie: 81, title: "La Anomalía Elden Ring", desc: "Un AA con presupuesto AAA rompe todas las reglas de diseño moderno." },
            { year: 2023, aaa: 67, aa: 70, indie: 84, title: "El Estándar Baldur's Gate", desc: "Demuestra que los jugadores quieren profundidad, no microtransacciones." },
            { year: 2024, aaa: 66, aa: 69, indie: 87, title: "El Colapso Laboral", desc: "Despidos masivos en estudios AAA por costes insostenibles." },
            { year: 2025, aaa: 65, aa: 68, indie: 90, title: "EL NUEVO ORDEN", desc: "Indie lidera innovación. AA es el estándar. AAA es nicho de lujo." }
        ];

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        scene.fog = new THREE.FogExp2(0x050505, 0.025);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Lights
        scene.add(new THREE.AmbientLight(0x404040, 3));
        const spot = new THREE.SpotLight(0xffffff, 50);
        spot.position.set(0, 20, 10);
        spot.angle = 0.5;
        scene.add(spot);

        // Floor
        const grid = new THREE.GridHelper(200, 50, 0x222222, 0x111111);
        scene.add(grid);

        // Objects
        const group = new THREE.Group();
        scene.add(group);
        const spacing = 8;
        
        const matAAA = new THREE.MeshStandardMaterial({ color: 0xff3333, roughness: 0.2, metalness: 0.8 });
        const matAA = new THREE.MeshStandardMaterial({ color: 0xffcc00, roughness: 0.2, metalness: 0.8 });
        const matIndie = new THREE.MeshStandardMaterial({ color: 0x00ffff, roughness: 0.2, metalness: 0.8 });
        
        // Font
        const loader = new FontLoader();
        loader.load('https://unpkg.com/three@0.154.0/examples/fonts/helvetiker_bold.typeface.json', (font) => {
            data.forEach((d, i) => {
                const z = -i * spacing;
                
                // Bars
                const b1 = new THREE.Mesh(new THREE.BoxGeometry(1.5, d.aaa/6, 1.5), matAAA);
                b1.position.set(-5, d.aaa/12, z);
                group.add(b1);
                
                const b2 = new THREE.Mesh(new THREE.BoxGeometry(1.5, d.aa/6, 1.5), matAA);
                b2.position.set(0, d.aa/12, z);
                group.add(b2);
                
                const b3 = new THREE.Mesh(new THREE.BoxGeometry(1.5, d.indie/6, 1.5), matIndie);
                b3.position.set(5, d.indie/12, z);
                group.add(b3);

                // Year Text on Floor
                const tGeo = new TextGeometry(d.year.toString(), { font, size: 1, height: 0.1 });
                const tMesh = new THREE.Mesh(tGeo, new THREE.MeshBasicMaterial({ color: 0x444444 }));
                tMesh.position.set(8, 0.1, z);
                tMesh.rotation.x = -Math.PI/2;
                group.add(tMesh);
                
                // Store data for retrieval
                const trigger = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshBasicMaterial({visible:false}));
                trigger.position.set(0,0,z);
                trigger.userData = d;
                group.add(trigger);
            });
            document.getElementById('loader').style.display = 'none';
        });

        // Bloom
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloom.threshold = 0.1; bloom.strength = 0.6; bloom.radius = 0.1;
        composer.addPass(bloom);

        // --- CONTROL LOGIC ---
        let targetZ = 0;
        let currentZ = 0;
        let handX = 0.5;
        let isFist = false;
        let isFocused = false; // "Entering" a section state
        let focusTargetZ = 0;

        // UI Elements
        const uiPanel = document.getElementById('detail-panel');
        const feedback = document.getElementById('gesture-feedback');

        // Hand Tracking
        const video = document.getElementById('input-video');
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6 });
        
        hands.onResults((results) => {
            if (results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                
                // 1. Navigation (X Position) - Inverted for mirror effect
                handX = 1 - lm[9].x; // Middle finger knuckle
                
                // 2. Gesture Detection (Fist vs Open)
                // Simple logic: distance between wrist and finger tips
                const wrist = lm[0];
                const tip = lm[12]; // Middle finger tip
                const dist = Math.sqrt(Math.pow(wrist.x - tip.x, 2) + Math.pow(wrist.y - tip.y, 2));
                
                // Threshold calibration may vary, but < 0.15 is usually a fist/closed hand
                isFist = dist < 0.2; 
            } else {
                handX = 0.5; // Stop if no hand
            }
        });

        const cam = new Camera(video, { onFrame: async () => await hands.send({image: video}), width: 640, height: 480 });
        cam.start();

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);

            // LOGIC
            if (isFocused) {
                // FOCUS MODE: Locked onto a specific year
                feedback.innerHTML = "MODO DETALLE (ABRE LA MANO PARA SALIR)";
                feedback.style.color = "#00ffff";
                
                // Smooth snap to target
                currentZ += (focusTargetZ - currentZ) * 0.1;
                
                // Exit condition
                if (!isFist) {
                    isFocused = false;
                    uiPanel.classList.remove('active');
                }
                
            } else {
                // NAVIGATION MODE
                uiPanel.classList.remove('active');
                
                // Movement logic
                let speed = 0;
                if (handX > 0.7) speed = -0.5; // Right -> Future
                if (handX < 0.3) speed = 0.5;  // Left -> Past
                
                if (speed !== 0) {
                    feedback.innerHTML = speed < 0 ? ">>> AVANZANDO" : "<<< RETROCEDIENDO";
                    feedback.style.color = "white";
                } else {
                    feedback.innerHTML = "PARADO (CIERRA PUÑO PARA ENTRAR)";
                    feedback.style.color = "#888";
                }

                targetZ += speed;
                
                // Limits
                const maxZ = 2;
                const minZ = -(data.length * spacing) + 10;
                targetZ = Math.max(minZ, Math.min(maxZ, targetZ));
                
                currentZ += (targetZ - currentZ) * 0.05;

                // Check for "Enter" gesture
                if (isFist && Math.abs(speed) === 0) {
                    // Find nearest year
                    const index = Math.round(Math.abs(currentZ) / spacing);
                    const d = data[index];
                    
                    if (d) {
                        isFocused = true;
                        focusTargetZ = -index * spacing; // Snap to exact position
                        
                        // Update UI
                        document.getElementById('ui-year').innerText = d.year;
                        document.getElementById('ui-aaa').innerText = d.aaa;
                        document.getElementById('ui-aa').innerText = d.aa;
                        document.getElementById('ui-indie').innerText = d.indie;
                        
                        document.getElementById('ui-event-title').innerText = d.title || "Sin eventos destacados";
                        document.getElementById('ui-event-desc').innerText = d.desc || "";
                        
                        uiPanel.classList.add('active');
                    }
                }
            }

            // Camera update
            // Standard View: Behind and above
            let camY = 8;
            let camZOffset = 15;
            
            if (isFocused) {
                // Focus View: Lower and closer for drama
                camY = 4;
                camZOffset = 8;
            }

            camera.position.lerp(new THREE.Vector3(0, camY, currentZ + camZOffset), 0.05);
            camera.lookAt(0, 2, currentZ - 5);

            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
</body>
</html>
